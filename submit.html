<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é›»æ³¢äººé–“QRã‚³ãƒ¼ãƒ‰æŠ•ç¨¿ã‚µã‚¤ãƒˆ</title>
<style>
body {
font-family: 'Helvetica Neue', Arial, sans-serif;
margin: 0;
padding: 20px;
background: #f5f5f5;
}
.container {
max-width: 800px;
margin: 0 auto;
background: white;
border-radius: 12px;
box-shadow: 0 4px 20px rgba(0,0,0,0.1);
overflow: hidden;
}
.header {
background: #f4d142;
color: #333;
padding: 20px;
text-align: center;
position: relative;
}
.title {
font-size: 24px;
font-weight: bold;
margin: 0;
}
.search-button {
position: absolute;
right: 20px;
top: 50%;
transform: translateY(-50%);
background: none;
border: none;
color: #333;
font-size: 24px;
cursor: pointer;
padding: 0;
transition: opacity 0.2s;
}
.search-button:hover {
opacity: 0.7;
}
.submit-section {
padding: 20px;
background: #fffbf0;
}
.submit-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
gap: 8px;
margin-bottom: 20px;
}
.submit-field {
position: relative;
}
.field-container {
display: flex;
flex-direction: column;
}
.field-label {
font-weight: bold;
color: #333;
font-size: 13px;
margin-bottom: 4px;
}
.field-input {
background: white;
border: 2px solid #e0e0e0;
border-radius: 6px;
padding: 8px 12px;
font-size: 13px;
width: 100%;
box-sizing: border-box;
transition: all 0.2s;
min-height: 20px;
}
.field-input:focus {
outline: none;
border-color: #f4d142;
box-shadow: 0 2px 8px rgba(244,209,66,0.2);
}
.submit-button {
background: #f4d142;
color: #333;
border: none;
padding: 12px 40px;
border-radius: 6px;
font-size: 16px;
font-weight: bold;
cursor: pointer;
width: 100%;
transition: background 0.2s;
}
.submit-button:hover {
background: #e6c23e;
}
.url-section {
background: white;
padding: 20px;
margin: 20px;
border-radius: 8px;
border: 2px solid #f4d142;
}
.url-label {
font-weight: bold;
color: #333;
font-size: 14px;
margin-bottom: 8px;
}
.url-input {
width: 100%;
padding: 10px;
border: 2px solid #e0e0e0;
border-radius: 6px;
font-size: 14px;
box-sizing: border-box;
}
.url-input:focus {
outline: none;
border-color: #f4d142;
box-shadow: 0 2px 8px rgba(244,209,66,0.2);
}
.success-message {
background: #d4edda;
border: 1px solid #c3e6cb;
color: #155724;
padding: 20px;
margin: 20px;
border-radius: 8px;
text-align: center;
display: none;
}
.footer {
text-align: center;
padding: 20px;
background: #f5f5f5;
font-size: 12px;
border-top: 1px solid #eee;
}
.footer a {
margin: 0 10px;
color: #666;
text-decoration: none;
}
.footer a:hover {
color: #f4d142;
text-decoration: underline;
}
.footer p {
margin-top: 10px;
color: #999;
}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1 class="title">é›»æ³¢äººé–“QRã‚³ãƒ¼ãƒ‰æŠ•ç¨¿ã‚µã‚¤ãƒˆ</h1>
<button class="search-button" onclick="location.href='index.html'" title="æ¤œç´¢ã‚µã‚¤ãƒˆ">ğŸ”</button>
</div>

<div class="submit-section">
<div class="submit-grid">
<!-- ã‚¢ãƒ³ãƒ†ãƒŠ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">ã‚¢ãƒ³ãƒ†ãƒŠ</div>
<input type="text" class="field-input" id="antenna-input" placeholder="ä¾‹: èˆˆå¥®" oninput="updateSubmitData('antenna', this.value)">
</div>
</div>

<!-- ä½“è‰² -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">ä½“è‰²</div>
<select class="field-input" id="bodyColor-input" onchange="updateSubmitData('bodyColor', this.value)">
<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
<option value="èµ¤">ğŸŸ¥ èµ¤</option>
<option value="é’">ğŸŸ¦ é’</option>
<option value="é»„">ğŸŸ¨ é»„</option>
<option value="æ©™">ğŸŸ§ æ©™</option>
<option value="ç·‘">ğŸŸ© ç·‘</option>
<option value="æ°´">ğŸ”µ æ°´</option>
<option value="é»’">â¬› é»’</option>
<option value="ãƒ”ãƒ³ã‚¯">ğŸ©· ãƒ”ãƒ³ã‚¯</option>
<option value="éŠ€">âš« éŠ€</option>
<option value="é‡‘">ğŸŸ¡ é‡‘</option>
</select>
</div>
</div>

<!-- ä½“æ ¼ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">ä½“æ ¼</div>
<select class="field-input" id="bodyType-input" onchange="updateSubmitData('bodyType', this.value)">
<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
<option value="æœ€å¤§">æœ€å¤§</option>
<option value="æº–å¤§">æº–å¤§</option>
<option value="ä¸­é–“">ä¸­é–“</option>
<option value="æº–é€Ÿ">æº–é€Ÿ</option>
<option value="æœ€é€Ÿ">æœ€é€Ÿ</option>
</select>
</div>
</div>

<!-- å›é¿ç‡ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">å›é¿ç‡</div>
<input type="text" class="field-input" id="dodgeRate-input" placeholder="ä¾‹: 3+" oninput="updateSubmitData('dodgeRate', this.value)">
</div>
</div>

<!-- é ­ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">é ­</div>
<input type="text" class="field-input" id="head-input" placeholder="ä¾‹: ä¸‰è§’" oninput="updateSubmitData('head', this.value)">
</div>
</div>

<!-- æ‰‹æ•° -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">æ‰‹æ•°</div>
<input type="text" class="field-input" id="attackCount-input" placeholder="ä¾‹: 1æ‰‹" oninput="updateSubmitData('attackCount', this.value)">
</div>
</div>

<!-- æŸ„ç¨®é¡ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">æŸ„ç¨®é¡</div>
<input type="text" class="field-input" id="patternType-input" placeholder="ä¾‹: èŠ±" oninput="updateSubmitData('patternType', this.value)">
</div>
</div>

<!-- æŸ„ãƒ©ãƒ³ã‚¯ -->
<div class="submit-field">
<div class="field-container">
<div class="field-label">æŸ„ãƒ©ãƒ³ã‚¯</div>
<select class="field-input" id="patternRank-input" onchange="updateSubmitData('patternRank', this.value)">
<option value="">é¸æŠã—ã¦ãã ã•ã„</option>
<option value="S">S</option>
<option value="A">A</option>
<option value="B">B</option>
<option value="C">C</option>
<option value="å˜è‰²">å˜è‰²</option>
</select>
</div>
</div>
</div>

<div class="url-section">
<div class="url-label">æƒ…å ±å…ƒURLï¼ˆå¿…é ˆï¼‰</div>
<input type="url" class="url-input" id="url-input" placeholder="https://x.com/user/status/123 ã¾ãŸã¯ https://example.com/" oninput="updateSubmitData('url', this.value)">
</div>

<button class="submit-button" id="submitButton" onclick="executeSubmit()">æŠ•ç¨¿ã™ã‚‹</button>
</div>

<div class="success-message" id="successMessage">
æŠ•ç¨¿ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼<br>
å†…å®¹ã‚’ç¢ºèªå¾Œã€ã‚µã‚¤ãƒˆã«åæ˜ ã„ãŸã—ã¾ã™ã€‚
</div>

<div class="footer">
<a href="privacy.html">ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</a>
<a href="about.html">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
<a href="https://github.com/siro-314/siro-314.github.io">GitHub</a>
<p>&copy; 2025 é›»æ³¢äººé–“QRã‚³ãƒ¼ãƒ‰æŠ•ç¨¿ã‚µã‚¤ãƒˆ</p>
</div>
</div>

<script>
let submitData = {
antenna: '',
bodyColor: '',
bodyType: '',
dodgeRate: '',
head: '',
attackCount: '',
patternType: '',
patternRank: '',
url: ''
};

let existingData = [];

// æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã¨pending-submissionsã‚’èª­ã¿è¾¼ã‚“ã§é‡è¤‡ãƒã‚§ãƒƒã‚¯
Promise.all([
fetch('data.json').then(res => res.json()).catch(() => []),
fetch('pending-submissions.json').then(res => res.json()).catch(() => [])
]).then(([mainData, pendingData]) => {
existingData = [...mainData, ...pendingData];
});

function updateSubmitData(field, value) {
submitData[field] = value.trim();
}

function executeSubmit() {
// å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
if (!submitData.url) {
alert('æƒ…å ±å…ƒURLã¯å¿…é ˆã§ã™');
return;
}

// é‡è¤‡ãƒã‚§ãƒƒã‚¯
if (isDuplicate()) {
alert('ã“ã®æƒ…å ±ã¯æ—¢ã«æŠ•ç¨¿æ¸ˆã¿ã§ã™');
return;
}

// JSONå½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™
const newEntry = {
antenna: submitData.antenna || null,
bodyColor: submitData.bodyColor || null,
bodyType: submitData.bodyType || null,
dodgeRate: submitData.dodgeRate || null,
head: submitData.head || null,
attackCount: submitData.attackCount || null,
pattern: {
type: submitData.patternType || null,
rank: submitData.patternRank || null
},
url: submitData.url
};

// pending-submissions.jsonã«è¿½åŠ 
saveToPendingSubmissions(newEntry);

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
document.getElementById('successMessage').style.display = 'block';
document.querySelector('.submit-section').style.display = 'none';

// ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
resetForm();
}

function isDuplicate() {
return existingData.some(item => {
if (submitData.url.includes('x.com') || submitData.url.includes('twitter.com')) {
// Twitterã¯URLå®Œå…¨ä¸€è‡´
return item.url === submitData.url;
} else {
// ãã®ä»–ã¯çµ„ã¿åˆã‚ã›ä¸€è‡´
return item.antenna === (submitData.antenna || null) &&
item.bodyColor === (submitData.bodyColor || null) &&
item.bodyType === (submitData.bodyType || null) &&
item.head === (submitData.head || null);
}
});
}

async function saveToPendingSubmissions(data) {
    const token = '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';
    const owner = 'siro-314';
    const repo = 'siro-314.github.io';
    const path = 'pending-submissions.json';
    
    try {
        console.log('ğŸš€ GitHub APIã§æŠ•ç¨¿é–‹å§‹...');
        
        // ç¾åœ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…å®¹ã‚’å–å¾—
        const getResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
            headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json'
            }
        });
        
        let currentData = [];
        let sha = '';
        
        if (getResponse.ok) {
            const fileInfo = await getResponse.json();
            sha = fileInfo.sha;
            const content = atob(fileInfo.content);
            currentData = JSON.parse(content);
            console.log('âœ… æ—¢å­˜ãƒ‡ãƒ¼ã‚¿å–å¾—å®Œäº†:', currentData.length + 'ä»¶');
        } else {
            console.log('ğŸ“ æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ¢ãƒ¼ãƒ‰');
        }
        
        // æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ 
        currentData.push(data);
        console.log('ğŸ“ æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿è¿½åŠ :', data);
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›´æ–°
        const updateResponse = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
            method: 'PUT',
            headers: {
                'Authorization': `token ${token}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                message: 'æ–°è¦QRã‚³ãƒ¼ãƒ‰æŠ•ç¨¿ - ' + new Date().toLocaleString('ja-JP'),
                content: btoa(JSON.stringify(currentData, null, 2)),
                sha: sha
            })
        });
        
        if (updateResponse.ok) {
            console.log('ğŸ‰ æŠ•ç¨¿å®Œäº†ï¼pending-submissions.jsonã«è‡ªå‹•è¿½åŠ ã•ã‚Œã¾ã—ãŸ');
            console.log('ğŸ“Š ç·ãƒ‡ãƒ¼ã‚¿æ•°:', currentData.length + 'ä»¶');
            return true;
        } else {
            const errorData = await updateResponse.json();
            console.error('âŒ API ã‚¨ãƒ©ãƒ¼:', errorData);
            throw new Error('GitHub APIæ›´æ–°å¤±æ•—: ' + errorData.message);
        }
        
    } catch (error) {
        console.error('ğŸš¨ ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼:', error);
        console.log('');
        console.log('ğŸ’¾ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šæ‰‹å‹•ã‚³ãƒ”ãƒšç”¨ãƒ‡ãƒ¼ã‚¿');
        console.log('='.repeat(50));
        console.log(JSON.stringify(data, null, 2));
        console.log('='.repeat(50));
        alert('è‡ªå‹•æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã®æ‰‹å‹•ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„ã€‚');
        return false;
    }
}

function resetForm() {
document.getElementById('antenna-input').value = '';
document.getElementById('bodyColor-input').value = '';
document.getElementById('bodyType-input').value = '';
document.getElementById('dodgeRate-input').value = '';
document.getElementById('head-input').value = '';
document.getElementById('attackCount-input').value = '';
document.getElementById('patternType-input').value = '';
document.getElementById('patternRank-input').value = '';
document.getElementById('url-input').value = '';
submitData = {
antenna: '',
bodyColor: '',
bodyType: '',
dodgeRate: '',
head: '',
attackCount: '',
patternType: '',
patternRank: '',
url: ''
};
}
</script>
</body>
</html>
